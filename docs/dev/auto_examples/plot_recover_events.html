<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Manually Recover Events Not Found by the Algorithm &#8212; pd-parser v0.8dev0 documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../_static/gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/gallery-rendered-html.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          pd-parser v0.8dev0</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="index.html">Examples</a></li>
                <li><a href="../api.html">API</a></li>
                <li><a href="../generated/cli.html">CLI</a></li>
                <li><a href="../whats_new.html">What's new</a></li>
                <li><a href="https://github.com/alexrockhill/pd-parser">GitHub</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/auto_examples/plot_recover_events.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-auto-examples-plot-recover-events-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="manually-recover-events-not-found-by-the-algorithm">
<span id="sphx-glr-auto-examples-plot-recover-events-py"></span><h1>Manually Recover Events Not Found by the Algorithm<a class="headerlink" href="#manually-recover-events-not-found-by-the-algorithm" title="Permalink to this headline">¶</a></h1>
<p>In this example, we use <code class="docutils literal notranslate"><span class="pre">pd-parser</span></code> to find photodiode events that
have corrupted pre-event baselines, photodiode plateaus or post-event
baselines but not corrupted onsets or offsets.
Note that it might be a good idea not to recover these events
as there might be noise in the data around this time.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Authors: Alex Rockhill &lt;aprockhill@mailbox.org&gt;</span>
<span class="c1">#</span>
<span class="c1"># License: BSD (3-clause)</span>
</pre></div>
</div>
<p>Simulate data and use it to make a raw object</p>
<p>We’ll make an <cite>mne.io.Raw</cite> object so that we can save out some random
data with a photodiode event channel in it in fif format (a commonly used
electrophysiology data format).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os.path</span> <span class="k">as</span> <span class="nn">op</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">mock</span>

<span class="kn">import</span> <span class="nn">mne</span>
<span class="kn">from</span> <span class="nn">mne.utils</span> <span class="kn">import</span> <span class="n">_TempDir</span>

<span class="kn">import</span> <span class="nn">pd_parser</span>
<span class="kn">from</span> <span class="nn">pd_parser.parse_pd</span> <span class="kn">import</span> <span class="n">_load_data</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">out_dir</span> <span class="o">=</span> <span class="n">_TempDir</span><span class="p">()</span>

<span class="c1"># simulate photodiode data</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">29</span><span class="p">)</span>
<span class="n">n_events</span> <span class="o">=</span> <span class="mi">300</span>
<span class="c1"># let&#39;s make our photodiode events on random uniform from 0.25 to 0.75 seconds</span>
<span class="n">n_secs_on</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">n_events</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.25</span>
<span class="n">raw</span><span class="p">,</span> <span class="n">beh</span><span class="p">,</span> <span class="n">events</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> \
    <span class="n">pd_parser</span><span class="o">.</span><span class="n">simulate_pd_data</span><span class="p">(</span><span class="n">n_events</span><span class="o">=</span><span class="n">n_events</span><span class="p">,</span> <span class="n">n_secs_on</span><span class="o">=</span><span class="n">n_secs_on</span><span class="p">,</span>
                               <span class="n">prop_corrupted</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">sfreq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">raw</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;sfreq&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="c1"># corrupt some events</span>
<span class="n">corrupted_indices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">234</span><span class="p">]</span>
<span class="n">amount</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">corrupted_indices</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Corrupted Events&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;voltage&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">events</span><span class="p">[</span><span class="n">corrupted_indices</span><span class="p">,</span> <span class="mi">0</span><span class="p">]):</span>
    <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">raw</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="n">sfreq</span> <span class="o">//</span> <span class="mi">5</span><span class="p">:</span> <span class="n">i</span> <span class="o">-</span> <span class="n">sfreq</span> <span class="o">//</span> <span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">amount</span>
    <span class="k">elif</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">raw</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="n">sfreq</span> <span class="o">//</span> <span class="mi">4</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="n">sfreq</span> <span class="o">//</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">amount</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">raw</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">sfreq</span> <span class="o">//</span> <span class="mi">4</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">sfreq</span> <span class="o">//</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">sfreq</span><span class="p">),</span>
                 <span class="n">raw</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="n">sfreq</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="n">sfreq</span> <span class="o">*</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time (s)&#39;</span><span class="p">)</span>


<span class="c1"># make figure nicer</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="c1"># make fake electrophysiology data</span>
<span class="n">info</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">create_info</span><span class="p">([</span><span class="s1">&#39;ch1&#39;</span><span class="p">,</span> <span class="s1">&#39;ch2&#39;</span><span class="p">,</span> <span class="s1">&#39;ch3&#39;</span><span class="p">],</span> <span class="n">raw</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;sfreq&#39;</span><span class="p">],</span>
                       <span class="p">[</span><span class="s1">&#39;seeg&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">raw2</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">RawArray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="n">raw</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">size</span><span class="p">))</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="n">info</span><span class="p">)</span>
<span class="n">raw2</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;lowpass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;lowpass&#39;</span><span class="p">]</span>  <span class="c1"># these must match to combine</span>
<span class="n">raw</span><span class="o">.</span><span class="n">add_channels</span><span class="p">([</span><span class="n">raw2</span><span class="p">])</span>
<span class="c1"># bids needs these data fields</span>
<span class="n">raw</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;dig&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">raw</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;line_freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">60</span>

<span class="c1"># add some offsets to the behavior so it&#39;s a bit more realistic</span>
<span class="n">offsets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n_events</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.001</span>
<span class="n">beh</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">beh</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">offsets</span>

<span class="c1"># save to disk as required by ``pd-parser``, raw needs to have a filename</span>
<span class="n">fname</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s1">&#39;sub-1_task-mytask_raw.fif&#39;</span><span class="p">)</span>
<span class="n">raw</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
</pre></div>
</div>
<img alt="Corrupted Events" class="sphx-glr-single-img" src="../_images/sphx_glr_plot_recover_events_001.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Creating RawArray with float64 data, n_channels=1, n_times=2039600
    Range : 0 ... 2039599 =      0.000 ...  2039.599 secs
Ready.
Creating RawArray with float64 data, n_channels=3, n_times=2039600
    Range : 0 ... 2039599 =      0.000 ...  2039.599 secs
Ready.
Writing /var/folders/s4/y1vlkn8d70jfw7s8s03m9p540000gn/T/tmp_mne_tempdir_9q7hw3p3/sub-1_task-mytask_raw.fif
Closing /var/folders/s4/y1vlkn8d70jfw7s8s03m9p540000gn/T/tmp_mne_tempdir_9q7hw3p3/sub-1_task-mytask_raw.fif
[done]
</pre></div>
</div>
<p>Find the photodiode events relative to the behavioral timing of interest</p>
<p>This function will use the default parameters to find and align the
photodiode events, recovering the events that we just corrupted.</p>
<p>Note that the mock function mocks user input so when you run the example,
you want to delete that line and unindent the next line, and then provide
your own input depending on whether you want to keep the events or not.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;builtins.input&#39;</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">):</span>
    <span class="n">pd_parser</span><span class="o">.</span><span class="n">parse_pd</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">pd_event_name</span><span class="o">=</span><span class="s1">&#39;Stim On&#39;</span><span class="p">,</span> <span class="n">beh</span><span class="o">=</span><span class="n">beh</span><span class="p">,</span> <span class="n">max_len</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
                       <span class="n">pd_ch_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;pd&#39;</span><span class="p">],</span> <span class="n">beh_key</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">recover</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<ul class="sphx-glr-horizontal">
<li><img alt="Alignment (First 10), Event Differences" class="sphx-glr-multi-img" src="../_images/sphx_glr_plot_recover_events_002.png" />
</li>
<li><img alt="Corrupted Event 8" class="sphx-glr-multi-img" src="../_images/sphx_glr_plot_recover_events_003.png" />
</li>
<li><img alt="Corrupted Event 144" class="sphx-glr-multi-img" src="../_images/sphx_glr_plot_recover_events_004.png" />
</li>
<li><img alt="Corrupted Event 234" class="sphx-glr-multi-img" src="../_images/sphx_glr_plot_recover_events_005.png" />
</li>
<li><img alt="Excluded Events, 8 recovered (not excluded), 144 recovered (not excluded), 234 recovered (not excluded)" class="sphx-glr-multi-img" src="../_images/sphx_glr_plot_recover_events_006.png" />
</li>
</ul>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Reading in /var/folders/s4/y1vlkn8d70jfw7s8s03m9p540000gn/T/tmp_mne_tempdir_9q7hw3p3/sub-1_task-mytask_raw.fif
Opening raw data file /var/folders/s4/y1vlkn8d70jfw7s8s03m9p540000gn/T/tmp_mne_tempdir_9q7hw3p3/sub-1_task-mytask_raw.fif...
Isotrak not found
    Range : 0 ... 2039599 =      0.000 ...  2039.599 secs
Ready.
Reading 0 ... 2039599  =      0.000 ...  2039.599 secs...
Finding photodiode events

  0%|          | 0/606 [00:00&lt;?, ?it/s]
 49%|####8     | 296/606 [00:00&lt;00:00, 2944.92it/s]
100%|##########| 606/606 [00:00&lt;00:00, 3227.61it/s]
301 up-deflection photodiode candidate events found
Checking best alignments

  0%|          | 0/300 [00:00&lt;?, ?it/s]
  1%|          | 2/300 [00:00&lt;00:16, 17.64it/s]
  1%|1         | 4/300 [00:00&lt;00:16, 17.81it/s]
  2%|2         | 6/300 [00:00&lt;00:16, 17.68it/s]
  3%|2         | 8/300 [00:00&lt;00:16, 17.84it/s]
  3%|3         | 10/300 [00:00&lt;00:16, 17.07it/s]
  4%|4         | 12/300 [00:00&lt;00:16, 17.48it/s]
  5%|4         | 14/300 [00:00&lt;00:16, 17.64it/s]
  5%|5         | 16/300 [00:00&lt;00:16, 17.23it/s]
  6%|6         | 18/300 [00:01&lt;00:16, 17.25it/s]
  7%|6         | 20/300 [00:01&lt;00:16, 17.27it/s]
  7%|7         | 22/300 [00:01&lt;00:15, 17.53it/s]
  8%|8         | 24/300 [00:01&lt;00:16, 17.23it/s]
  9%|8         | 26/300 [00:01&lt;00:16, 16.26it/s]
  9%|9         | 28/300 [00:01&lt;00:16, 16.56it/s]
 10%|#         | 30/300 [00:01&lt;00:15, 16.95it/s]
 11%|#         | 32/300 [00:01&lt;00:17, 15.76it/s]
 11%|#1        | 34/300 [00:02&lt;00:19, 13.90it/s]
 12%|#2        | 36/300 [00:02&lt;00:17, 14.68it/s]
 13%|#2        | 38/300 [00:02&lt;00:18, 14.53it/s]
 13%|#3        | 40/300 [00:02&lt;00:19, 13.44it/s]
 14%|#4        | 42/300 [00:02&lt;00:18, 14.17it/s]
 15%|#4        | 44/300 [00:02&lt;00:17, 14.57it/s]
 15%|#5        | 46/300 [00:02&lt;00:16, 15.36it/s]
 16%|#6        | 48/300 [00:02&lt;00:15, 15.77it/s]
 17%|#6        | 50/300 [00:03&lt;00:15, 15.63it/s]
 17%|#7        | 52/300 [00:03&lt;00:15, 15.78it/s]
 18%|#8        | 54/300 [00:03&lt;00:15, 16.24it/s]
 19%|#8        | 56/300 [00:03&lt;00:14, 16.36it/s]
 19%|#9        | 58/300 [00:03&lt;00:14, 16.60it/s]
 20%|##        | 60/300 [00:03&lt;00:14, 16.87it/s]
 21%|##        | 62/300 [00:03&lt;00:13, 17.06it/s]
 21%|##1       | 64/300 [00:03&lt;00:13, 17.20it/s]
 22%|##2       | 66/300 [00:04&lt;00:13, 17.27it/s]
 23%|##2       | 68/300 [00:04&lt;00:13, 17.43it/s]
 23%|##3       | 70/300 [00:04&lt;00:13, 17.42it/s]
 24%|##4       | 72/300 [00:04&lt;00:13, 16.99it/s]
 25%|##4       | 74/300 [00:04&lt;00:13, 16.73it/s]
 25%|##5       | 76/300 [00:04&lt;00:13, 17.05it/s]
 26%|##6       | 78/300 [00:04&lt;00:12, 17.39it/s]
 27%|##6       | 80/300 [00:04&lt;00:12, 17.48it/s]
 27%|##7       | 82/300 [00:04&lt;00:12, 17.42it/s]
 28%|##8       | 84/300 [00:05&lt;00:12, 17.36it/s]
 29%|##8       | 86/300 [00:05&lt;00:12, 17.46it/s]
 29%|##9       | 88/300 [00:05&lt;00:12, 17.41it/s]
 30%|###       | 90/300 [00:05&lt;00:12, 17.47it/s]
 31%|###       | 92/300 [00:05&lt;00:11, 17.53it/s]
 31%|###1      | 94/300 [00:05&lt;00:11, 17.44it/s]
 32%|###2      | 96/300 [00:05&lt;00:11, 17.50it/s]
 33%|###2      | 98/300 [00:05&lt;00:11, 17.53it/s]
 33%|###3      | 100/300 [00:06&lt;00:11, 17.20it/s]
 34%|###4      | 102/300 [00:06&lt;00:11, 17.36it/s]
 35%|###4      | 104/300 [00:06&lt;00:11, 17.49it/s]
 35%|###5      | 106/300 [00:06&lt;00:11, 17.48it/s]
 36%|###6      | 108/300 [00:06&lt;00:10, 17.59it/s]
 37%|###6      | 110/300 [00:06&lt;00:10, 17.55it/s]
 37%|###7      | 112/300 [00:06&lt;00:10, 17.63it/s]
 38%|###8      | 114/300 [00:06&lt;00:10, 17.67it/s]
 39%|###8      | 116/300 [00:06&lt;00:10, 17.75it/s]
 39%|###9      | 118/300 [00:07&lt;00:10, 17.62it/s]
 40%|####      | 120/300 [00:07&lt;00:10, 17.61it/s]
 41%|####      | 122/300 [00:07&lt;00:10, 17.65it/s]
 41%|####1     | 124/300 [00:07&lt;00:10, 17.56it/s]
 42%|####2     | 126/300 [00:07&lt;00:09, 17.53it/s]
 43%|####2     | 128/300 [00:07&lt;00:10, 16.68it/s]
 43%|####3     | 130/300 [00:07&lt;00:09, 17.06it/s]
 44%|####4     | 132/300 [00:07&lt;00:09, 17.08it/s]
 45%|####4     | 134/300 [00:07&lt;00:10, 16.00it/s]
 45%|####5     | 136/300 [00:08&lt;00:10, 15.47it/s]
 46%|####6     | 138/300 [00:08&lt;00:10, 15.67it/s]
 47%|####6     | 140/300 [00:08&lt;00:09, 16.14it/s]
 47%|####7     | 142/300 [00:08&lt;00:09, 16.46it/s]
 48%|####8     | 144/300 [00:08&lt;00:09, 16.71it/s]
 49%|####8     | 146/300 [00:08&lt;00:10, 15.19it/s]
 49%|####9     | 148/300 [00:08&lt;00:09, 15.75it/s]
 50%|#####     | 150/300 [00:09&lt;00:09, 15.96it/s]
 51%|#####     | 152/300 [00:09&lt;00:09, 16.31it/s]
 51%|#####1    | 154/300 [00:09&lt;00:08, 16.42it/s]
 52%|#####2    | 156/300 [00:09&lt;00:08, 16.46it/s]
 53%|#####2    | 158/300 [00:09&lt;00:08, 16.23it/s]
 53%|#####3    | 160/300 [00:09&lt;00:08, 16.40it/s]
 54%|#####4    | 162/300 [00:09&lt;00:08, 15.61it/s]
 55%|#####4    | 164/300 [00:09&lt;00:09, 15.05it/s]
 55%|#####5    | 166/300 [00:10&lt;00:08, 15.57it/s]
 56%|#####6    | 168/300 [00:10&lt;00:08, 15.96it/s]
 57%|#####6    | 170/300 [00:10&lt;00:08, 16.22it/s]
 57%|#####7    | 172/300 [00:10&lt;00:07, 16.40it/s]
 58%|#####8    | 174/300 [00:10&lt;00:07, 16.13it/s]
 59%|#####8    | 176/300 [00:10&lt;00:08, 14.92it/s]
 59%|#####9    | 178/300 [00:10&lt;00:08, 14.30it/s]
 60%|######    | 180/300 [00:10&lt;00:08, 14.56it/s]
 61%|######    | 182/300 [00:11&lt;00:08, 13.92it/s]
 61%|######1   | 184/300 [00:11&lt;00:08, 13.85it/s]
 62%|######2   | 186/300 [00:11&lt;00:07, 14.65it/s]
 63%|######2   | 188/300 [00:11&lt;00:07, 15.12it/s]
 63%|######3   | 190/300 [00:11&lt;00:07, 15.31it/s]
 64%|######4   | 192/300 [00:11&lt;00:07, 15.04it/s]
 65%|######4   | 194/300 [00:11&lt;00:07, 14.77it/s]
 65%|######5   | 196/300 [00:12&lt;00:07, 13.67it/s]
 66%|######6   | 198/300 [00:12&lt;00:07, 13.85it/s]
 67%|######6   | 200/300 [00:12&lt;00:07, 13.56it/s]
 67%|######7   | 202/300 [00:12&lt;00:07, 13.49it/s]
 68%|######8   | 204/300 [00:12&lt;00:07, 13.53it/s]
 69%|######8   | 206/300 [00:12&lt;00:07, 12.76it/s]
 69%|######9   | 208/300 [00:12&lt;00:06, 13.21it/s]
 70%|#######   | 210/300 [00:13&lt;00:06, 13.81it/s]
 71%|#######   | 212/300 [00:13&lt;00:06, 14.39it/s]
 71%|#######1  | 214/300 [00:13&lt;00:05, 14.87it/s]
 72%|#######2  | 216/300 [00:13&lt;00:05, 14.84it/s]
 73%|#######2  | 218/300 [00:13&lt;00:05, 15.24it/s]
 73%|#######3  | 220/300 [00:13&lt;00:05, 14.97it/s]
 74%|#######4  | 222/300 [00:13&lt;00:05, 14.98it/s]
 75%|#######4  | 224/300 [00:14&lt;00:04, 15.28it/s]
 75%|#######5  | 226/300 [00:14&lt;00:04, 14.91it/s]
 76%|#######6  | 228/300 [00:14&lt;00:04, 15.34it/s]
 77%|#######6  | 230/300 [00:14&lt;00:04, 14.80it/s]
 77%|#######7  | 232/300 [00:14&lt;00:04, 14.24it/s]
 78%|#######8  | 234/300 [00:15&lt;00:07,  8.67it/s]
 79%|#######8  | 236/300 [00:15&lt;00:09,  7.10it/s]
 79%|#######9  | 237/300 [00:15&lt;00:10,  5.90it/s]
 80%|#######9  | 239/300 [00:15&lt;00:09,  6.57it/s]
 80%|########  | 240/300 [00:16&lt;00:11,  5.37it/s]
 81%|########  | 242/300 [00:16&lt;00:08,  6.61it/s]
 81%|########1 | 244/300 [00:16&lt;00:06,  8.10it/s]
 82%|########2 | 246/300 [00:16&lt;00:05,  9.42it/s]
 83%|########2 | 248/300 [00:16&lt;00:05, 10.15it/s]
 83%|########3 | 250/300 [00:16&lt;00:05,  9.50it/s]
 84%|########4 | 252/300 [00:17&lt;00:05,  8.33it/s]
 84%|########4 | 253/300 [00:17&lt;00:05,  8.55it/s]
 85%|########5 | 255/300 [00:17&lt;00:04,  9.52it/s]
 86%|########5 | 257/300 [00:18&lt;00:06,  6.69it/s]
 86%|########6 | 258/300 [00:18&lt;00:06,  6.67it/s]
 86%|########6 | 259/300 [00:18&lt;00:09,  4.26it/s]
 87%|########6 | 260/300 [00:19&lt;00:16,  2.50it/s]
 87%|########7 | 261/300 [00:19&lt;00:15,  2.52it/s]
 87%|########7 | 262/300 [00:20&lt;00:16,  2.36it/s]
 88%|########7 | 263/300 [00:20&lt;00:17,  2.13it/s]
 88%|########8 | 264/300 [00:21&lt;00:16,  2.21it/s]
 88%|########8 | 265/300 [00:21&lt;00:17,  1.94it/s]
 89%|########8 | 266/300 [00:22&lt;00:14,  2.32it/s]
 89%|########9 | 267/300 [00:22&lt;00:11,  2.86it/s]
 89%|########9 | 268/300 [00:22&lt;00:10,  3.06it/s]
 90%|########9 | 269/300 [00:22&lt;00:08,  3.63it/s]
 90%|######### | 270/300 [00:22&lt;00:07,  4.17it/s]
 90%|######### | 271/300 [00:23&lt;00:06,  4.59it/s]
 91%|######### | 272/300 [00:23&lt;00:05,  5.30it/s]
 91%|#########1| 273/300 [00:23&lt;00:04,  6.12it/s]
 91%|#########1| 274/300 [00:23&lt;00:03,  6.81it/s]
 92%|#########1| 275/300 [00:23&lt;00:03,  6.49it/s]
 92%|#########2| 277/300 [00:23&lt;00:03,  7.48it/s]
 93%|#########2| 278/300 [00:23&lt;00:02,  8.02it/s]
 93%|#########3| 280/300 [00:23&lt;00:02,  8.91it/s]
 94%|#########3| 282/300 [00:24&lt;00:01, 10.09it/s]
 95%|#########4| 284/300 [00:24&lt;00:01, 10.19it/s]
 95%|#########5| 286/300 [00:24&lt;00:01, 10.78it/s]
 96%|#########6| 288/300 [00:24&lt;00:01, 11.81it/s]
 97%|#########6| 290/300 [00:24&lt;00:00, 12.30it/s]
 97%|#########7| 292/300 [00:24&lt;00:00, 12.80it/s]
 98%|#########8| 294/300 [00:25&lt;00:00, 13.12it/s]
 99%|#########8| 296/300 [00:25&lt;00:00, 13.61it/s]
 99%|#########9| 298/300 [00:25&lt;00:00, 14.05it/s]
100%|##########| 300/300 [00:25&lt;00:00, 14.26it/s]
100%|##########| 300/300 [00:25&lt;00:00, 11.79it/s]
Best alignment is with the first behavioral event shifted 0.00 s relative to the first synchronization event and has errors: min -3.82 ms, q1 -1.00 ms, med -0.02 ms, q3 0.89 ms, max 3.73 ms, 2 missed events
Excluding events that have zero close synchronization events or more than one synchronization event within `max_len` time
8 recovered (not excluded)
144 recovered (not excluded)
234 recovered (not excluded)
</pre></div>
</div>
<p>Find cessations of the photodiode deflections</p>
<p>Since we manually intervened for the onsets, on those same trials, we’ll
have to manually intervene for the offsets.</p>
<p>On the documentation webpage, this is example is not interactive,
but if you download it as a jupyter notebook and run it or copy the code
into a console running python (ipython recommended), you can see how to
interact with the window to accept or reject the recovered events by
following the instructions.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># reject the two false deflections in the middle of the second event</span>
<span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;builtins.input&#39;</span><span class="p">,</span> <span class="n">side_effect</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">):</span>
    <span class="n">pd_parser</span><span class="o">.</span><span class="n">add_pd_off_events</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">max_len</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">off_event_name</span><span class="o">=</span><span class="s1">&#39;Stim Off&#39;</span><span class="p">)</span>
</pre></div>
</div>
<ul class="sphx-glr-horizontal">
<li><img alt="Corrupted Event 144" class="sphx-glr-multi-img" src="../_images/sphx_glr_plot_recover_events_007.png" />
</li>
<li><img alt="Corrupted Event 144" class="sphx-glr-multi-img" src="../_images/sphx_glr_plot_recover_events_008.png" />
</li>
<li><img alt="Corrupted Event 144" class="sphx-glr-multi-img" src="../_images/sphx_glr_plot_recover_events_009.png" />
</li>
<li><img alt="Corrupted Event 234" class="sphx-glr-multi-img" src="../_images/sphx_glr_plot_recover_events_010.png" />
</li>
</ul>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Reading in /var/folders/s4/y1vlkn8d70jfw7s8s03m9p540000gn/T/tmp_mne_tempdir_9q7hw3p3/sub-1_task-mytask_raw.fif
Opening raw data file /var/folders/s4/y1vlkn8d70jfw7s8s03m9p540000gn/T/tmp_mne_tempdir_9q7hw3p3/sub-1_task-mytask_raw.fif...
Isotrak not found
    Range : 0 ... 2039599 =      0.000 ...  2039.599 secs
Ready.
Reading 0 ... 2039599  =      0.000 ...  2039.599 secs...
Finding photodiode events

  0%|          | 0/606 [00:00&lt;?, ?it/s]
 55%|#####4    | 332/606 [00:00&lt;00:00, 3315.27it/s]
 99%|#########9| 602/606 [00:00&lt;00:00, 3102.75it/s]
100%|##########| 606/606 [00:00&lt;00:00, 2995.91it/s]
301 up-deflection photodiode candidate events found
144 recovered (not excluded)
234 recovered (not excluded)
Overwriting existing file.
</pre></div>
</div>
<p>Check the results</p>
<p>Finally, we’ll check that the recovered events and the original events match.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">annot</span> <span class="o">=</span> <span class="n">_load_data</span><span class="p">(</span><span class="n">fname</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">raw</span><span class="o">.</span><span class="n">set_annotations</span><span class="p">(</span><span class="n">annot</span><span class="p">)</span>
<span class="n">events2</span><span class="p">,</span> <span class="n">event_id</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">events_from_annotations</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
<span class="n">on_events</span> <span class="o">=</span> <span class="n">events2</span><span class="p">[</span><span class="n">events2</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">event_id</span><span class="p">[</span><span class="s1">&#39;Stim On&#39;</span><span class="p">]]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Original: </span><span class="si">{</span><span class="n">events</span><span class="p">[</span><span class="n">corrupted_indices</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
      <span class="sa">f</span><span class="s1">&#39;Recovered: </span><span class="si">{</span><span class="n">on_events</span><span class="p">[</span><span class="n">corrupted_indices</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">off_events</span> <span class="o">=</span> <span class="n">events2</span><span class="p">[</span><span class="n">events2</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">event_id</span><span class="p">[</span><span class="s1">&#39;Stim Off&#39;</span><span class="p">]]</span>
<span class="n">original_off</span> <span class="o">=</span> <span class="n">events</span><span class="p">[</span><span class="n">corrupted_indices</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> \
    <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">n_secs_on</span><span class="p">[</span><span class="n">corrupted_indices</span><span class="p">]</span> <span class="o">*</span> <span class="n">raw</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;sfreq&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Original off: </span><span class="si">{</span><span class="n">original_off</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
      <span class="sa">f</span><span class="s1">&#39;Recovered off: </span><span class="si">{</span><span class="n">off_events</span><span class="p">[</span><span class="n">corrupted_indices</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Reading in /var/folders/s4/y1vlkn8d70jfw7s8s03m9p540000gn/T/tmp_mne_tempdir_9q7hw3p3/sub-1_task-mytask_raw.fif
Opening raw data file /var/folders/s4/y1vlkn8d70jfw7s8s03m9p540000gn/T/tmp_mne_tempdir_9q7hw3p3/sub-1_task-mytask_raw.fif...
Isotrak not found
    Range : 0 ... 2039599 =      0.000 ...  2039.599 secs
Ready.
Used Annotations descriptions: [&#39;Stim Off&#39;, &#39;Stim On&#39;]
Original: [  65602  989660 1595483]
Recovered: [  65602  989660 1595483]
Original off: [  66236  990198 1596131]
Recovered off: [  66236  990197 1596130]
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  35.956 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-plot-recover-events-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/3b9b6f3cd8645b6f7e8cdb8a4aee6517/plot_recover_events.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_recover_events.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/5258f1bb54b38679ec8488158187b98c/plot_recover_events.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_recover_events.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2020, Alex Rockhill.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.3.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>