<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Manually Recover Events Not Found by the Algorithm &#8212; pd-parser v0.5dev0 documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../_static/gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/gallery-rendered-html.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          pd-parser v0.5dev0</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="index.html">Examples</a></li>
                <li><a href="../api.html">API</a></li>
                <li><a href="../generated/cli.html">CLI</a></li>
                <li><a href="../whats_new.html">What's new</a></li>
                <li><a href="https://github.com/alexrockhill/pd-parser">GitHub</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/auto_examples/plot_recover_events.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-auto-examples-plot-recover-events-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="manually-recover-events-not-found-by-the-algorithm">
<span id="sphx-glr-auto-examples-plot-recover-events-py"></span><h1>Manually Recover Events Not Found by the Algorithm<a class="headerlink" href="#manually-recover-events-not-found-by-the-algorithm" title="Permalink to this headline">¶</a></h1>
<p>In this example, we use <code class="docutils literal notranslate"><span class="pre">pd-parser</span></code> to find photodiode events that
have corrupted pre-event baselines, photodiode plateaus or post-event
baselines but not corrupted onsets or offsets.
Note that it might be a good idea not to recover these events
as there might be noise in the data around this time.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Authors: Alex Rockhill &lt;aprockhill@mailbox.org&gt;</span>
<span class="c1">#</span>
<span class="c1"># License: BSD (3-clause)</span>
</pre></div>
</div>
<p>Simulate data and use it to make a raw object:</p>
<p>We’ll make an <cite>mne.io.Raw</cite> object so that we can save out some random
data with a photodiode event channel in it in fif format (a commonly used
electrophysiology data format).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os.path</span> <span class="k">as</span> <span class="nn">op</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">mock</span>

<span class="kn">import</span> <span class="nn">mne</span>
<span class="kn">from</span> <span class="nn">mne.utils</span> <span class="kn">import</span> <span class="n">_TempDir</span>

<span class="kn">import</span> <span class="nn">pd_parser</span>
<span class="kn">from</span> <span class="nn">pd_parser.parse_pd</span> <span class="kn">import</span> <span class="n">_load_data</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">out_dir</span> <span class="o">=</span> <span class="n">_TempDir</span><span class="p">()</span>

<span class="c1"># simulate photodiode data</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">29</span><span class="p">)</span>
<span class="n">n_events</span> <span class="o">=</span> <span class="mi">300</span>
<span class="c1"># let&#39;s make our photodiode events on random uniform from 0.25 to 0.75 seconds</span>
<span class="n">n_secs_on</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">n_events</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.25</span>
<span class="n">raw</span><span class="p">,</span> <span class="n">beh</span><span class="p">,</span> <span class="n">events</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> \
    <span class="n">pd_parser</span><span class="o">.</span><span class="n">simulate_pd_data</span><span class="p">(</span><span class="n">n_events</span><span class="o">=</span><span class="n">n_events</span><span class="p">,</span> <span class="n">n_secs_on</span><span class="o">=</span><span class="n">n_secs_on</span><span class="p">,</span>
                               <span class="n">prop_corrupted</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">sfreq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">raw</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;sfreq&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="c1"># corrupt some events</span>
<span class="n">corrupted_indices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">234</span><span class="p">]</span>
<span class="n">amount</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">corrupted_indices</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Corrupted Events&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;voltage&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">events</span><span class="p">[</span><span class="n">corrupted_indices</span><span class="p">,</span> <span class="mi">0</span><span class="p">]):</span>
    <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">raw</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="n">sfreq</span> <span class="o">//</span> <span class="mi">5</span><span class="p">:</span> <span class="n">i</span> <span class="o">-</span> <span class="n">sfreq</span> <span class="o">//</span> <span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">amount</span>
    <span class="k">elif</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">raw</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="n">sfreq</span> <span class="o">//</span> <span class="mi">4</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="n">sfreq</span> <span class="o">//</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">amount</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">raw</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">sfreq</span> <span class="o">//</span> <span class="mi">4</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">sfreq</span> <span class="o">//</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">sfreq</span><span class="p">),</span>
                 <span class="n">raw</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="n">sfreq</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="n">sfreq</span> <span class="o">*</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time (s)&#39;</span><span class="p">)</span>


<span class="c1"># make figure nicer</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="c1"># make fake electrophysiology data</span>
<span class="n">info</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">create_info</span><span class="p">([</span><span class="s1">&#39;ch1&#39;</span><span class="p">,</span> <span class="s1">&#39;ch2&#39;</span><span class="p">,</span> <span class="s1">&#39;ch3&#39;</span><span class="p">],</span> <span class="n">raw</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;sfreq&#39;</span><span class="p">],</span>
                       <span class="p">[</span><span class="s1">&#39;seeg&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">raw2</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">RawArray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="n">raw</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">size</span><span class="p">))</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="n">info</span><span class="p">)</span>
<span class="n">raw2</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;lowpass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;lowpass&#39;</span><span class="p">]</span>  <span class="c1"># these must match to combine</span>
<span class="n">raw</span><span class="o">.</span><span class="n">add_channels</span><span class="p">([</span><span class="n">raw2</span><span class="p">])</span>
<span class="c1"># bids needs these data fields</span>
<span class="n">raw</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;dig&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">raw</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;line_freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">60</span>

<span class="c1"># add some offsets to the behavior so it&#39;s a bit more realistic</span>
<span class="n">offsets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n_events</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.001</span>
<span class="n">beh</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">beh</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">offsets</span>

<span class="c1"># save to disk as required by ``pd-parser``, raw needs to have a filename</span>
<span class="n">fname</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s1">&#39;sub-1_task-mytask_raw.fif&#39;</span><span class="p">)</span>
<span class="n">raw</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
</pre></div>
</div>
<img alt="Corrupted Events" class="sphx-glr-single-img" src="../_images/sphx_glr_plot_recover_events_001.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Creating RawArray with float64 data, n_channels=1, n_times=2035104
    Range : 0 ... 2035103 =      0.000 ...  2035.103 secs
Ready.
Creating RawArray with float64 data, n_channels=3, n_times=2035104
    Range : 0 ... 2035103 =      0.000 ...  2035.103 secs
Ready.
Writing /var/folders/s4/y1vlkn8d70jfw7s8s03m9p540000gn/T/tmp_mne_tempdir_de9nwvs_/sub-1_task-mytask_raw.fif
Closing /var/folders/s4/y1vlkn8d70jfw7s8s03m9p540000gn/T/tmp_mne_tempdir_de9nwvs_/sub-1_task-mytask_raw.fif
[done]
</pre></div>
</div>
<p>Find the photodiode events relative to the behavioral timing of interest:</p>
<p>This function will use the default parameters to find and align the
photodiode events, recovering the events that we just corrupted.</p>
<p>Note that the mock function mocks user input so when you run the example,
you want to delete that line and unindent the next line, and then provide
your own input depending on whether you want to keep the events or not.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;builtins.input&#39;</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">):</span>
    <span class="n">pd_parser</span><span class="o">.</span><span class="n">parse_pd</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">pd_event_name</span><span class="o">=</span><span class="s1">&#39;Stim On&#39;</span><span class="p">,</span> <span class="n">beh</span><span class="o">=</span><span class="n">beh</span><span class="p">,</span>
                       <span class="n">pd_ch_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;pd&#39;</span><span class="p">],</span> <span class="n">beh_key</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">recover</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<ul class="sphx-glr-horizontal">
<li><img alt="Corrupted Event 8" class="sphx-glr-multi-img" src="../_images/sphx_glr_plot_recover_events_002.png" />
</li>
<li><img alt="Corrupted Event 144" class="sphx-glr-multi-img" src="../_images/sphx_glr_plot_recover_events_003.png" />
</li>
<li><img alt="Corrupted Event 234" class="sphx-glr-multi-img" src="../_images/sphx_glr_plot_recover_events_004.png" />
</li>
<li><img alt="Excluded Events, Event 8 recovered (not excluded), Event 144 recovered (not excluded), Event 234 recovered (not excluded)" class="sphx-glr-multi-img" src="../_images/sphx_glr_plot_recover_events_005.png" />
</li>
<li><img alt="Synchronization Events Compared to Behavior Events" class="sphx-glr-multi-img" src="../_images/sphx_glr_plot_recover_events_006.png" />
</li>
</ul>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Reading in /var/folders/s4/y1vlkn8d70jfw7s8s03m9p540000gn/T/tmp_mne_tempdir_de9nwvs_/sub-1_task-mytask_raw.fif
Opening raw data file /var/folders/s4/y1vlkn8d70jfw7s8s03m9p540000gn/T/tmp_mne_tempdir_de9nwvs_/sub-1_task-mytask_raw.fif...
Isotrak not found
    Range : 0 ... 2035103 =      0.000 ...  2035.103 secs
Ready.
Reading 0 ... 2035103  =      0.000 ...  2035.103 secs...
Finding photodiode events

  0%|          | 0/16269 [00:00&lt;?, ?it/s]
  1%|1         | 195/16269 [00:00&lt;00:12, 1308.17it/s]
  2%|1         | 252/16269 [00:00&lt;00:17, 939.51it/s]
  2%|2         | 348/16269 [00:00&lt;00:16, 944.93it/s]
  3%|2         | 437/16269 [00:00&lt;00:17, 927.32it/s]
  3%|3         | 506/16269 [00:00&lt;00:40, 392.53it/s]
  4%|3         | 633/16269 [00:00&lt;00:31, 495.05it/s]
  5%|4         | 803/16269 [00:01&lt;00:24, 628.37it/s]
  6%|5         | 959/16269 [00:01&lt;00:20, 760.26it/s]
  7%|6         | 1095/16269 [00:01&lt;00:17, 876.17it/s]
  8%|7         | 1232/16269 [00:01&lt;00:15, 977.36it/s]
  8%|8         | 1359/16269 [00:01&lt;00:15, 956.21it/s]
  9%|9         | 1480/16269 [00:01&lt;00:14, 1019.82it/s]
 10%|9         | 1598/16269 [00:01&lt;00:23, 628.15it/s]
 10%|#         | 1690/16269 [00:02&lt;00:21, 663.30it/s]
 11%|#1        | 1790/16269 [00:02&lt;00:20, 712.42it/s]
 12%|#1        | 1877/16269 [00:02&lt;00:20, 686.15it/s]
 12%|#2        | 1972/16269 [00:02&lt;00:19, 748.01it/s]
 13%|#2        | 2059/16269 [00:02&lt;00:24, 585.50it/s]
 13%|#3        | 2142/16269 [00:02&lt;00:22, 634.30it/s]
 14%|#3        | 2235/16269 [00:02&lt;00:20, 699.19it/s]
 14%|#4        | 2349/16269 [00:02&lt;00:17, 790.72it/s]
 15%|#5        | 2500/16269 [00:03&lt;00:14, 922.18it/s]
 16%|#6        | 2624/16269 [00:03&lt;00:13, 998.67it/s]
 19%|#8        | 3017/16269 [00:03&lt;00:10, 1286.51it/s]
 21%|##        | 3395/16269 [00:03&lt;00:08, 1603.83it/s]
 23%|##3       | 3764/16269 [00:03&lt;00:06, 1930.65it/s]
 26%|##5       | 4177/16269 [00:03&lt;00:05, 2297.44it/s]
 28%|##8       | 4576/16269 [00:03&lt;00:04, 2631.37it/s]
 31%|###       | 4966/16269 [00:03&lt;00:03, 2914.54it/s]
 33%|###2      | 5364/16269 [00:03&lt;00:03, 3167.88it/s]
 35%|###5      | 5764/16269 [00:03&lt;00:03, 3376.61it/s]
 38%|###7      | 6174/16269 [00:04&lt;00:02, 3564.50it/s]
 40%|####      | 6566/16269 [00:04&lt;00:02, 3663.05it/s]
 43%|####2     | 6956/16269 [00:04&lt;00:02, 3689.23it/s]
 45%|####5     | 7361/16269 [00:04&lt;00:02, 3787.27it/s]
 48%|####7     | 7777/16269 [00:04&lt;00:02, 3889.25it/s]
 50%|#####     | 8175/16269 [00:04&lt;00:02, 3300.76it/s]
 52%|#####2    | 8527/16269 [00:04&lt;00:02, 3263.58it/s]
 55%|#####4    | 8938/16269 [00:04&lt;00:02, 3475.52it/s]
 57%|#####7    | 9301/16269 [00:04&lt;00:02, 3457.96it/s]
 59%|#####9    | 9657/16269 [00:05&lt;00:01, 3351.07it/s]
 62%|######1   | 10036/16269 [00:05&lt;00:01, 3469.69it/s]
 64%|######3   | 10390/16269 [00:05&lt;00:01, 3226.85it/s]
 66%|######5   | 10721/16269 [00:05&lt;00:01, 3171.38it/s]
 68%|######7   | 11044/16269 [00:05&lt;00:01, 3055.13it/s]
 70%|######9   | 11355/16269 [00:05&lt;00:01, 2914.14it/s]
 72%|#######1  | 11653/16269 [00:05&lt;00:01, 2932.68it/s]
 73%|#######3  | 11950/16269 [00:05&lt;00:01, 2922.49it/s]
 76%|#######5  | 12295/16269 [00:05&lt;00:01, 3062.97it/s]
 78%|#######7  | 12659/16269 [00:06&lt;00:01, 3214.20it/s]
 80%|########  | 13024/16269 [00:06&lt;00:00, 3333.50it/s]
 82%|########2 | 13380/16269 [00:06&lt;00:00, 3397.66it/s]
 84%|########4 | 13735/16269 [00:06&lt;00:00, 3441.52it/s]
 87%|########6 | 14095/16269 [00:06&lt;00:00, 3485.80it/s]
 89%|########8 | 14446/16269 [00:06&lt;00:00, 3221.75it/s]
 91%|#########1| 14826/16269 [00:06&lt;00:00, 3375.55it/s]
 93%|#########3| 15170/16269 [00:06&lt;00:00, 3250.19it/s]
 95%|#########5| 15500/16269 [00:06&lt;00:00, 3231.71it/s]
 98%|#########7| 15900/16269 [00:06&lt;00:00, 3428.39it/s]
100%|##########| 16269/16269 [00:07&lt;00:00, 2295.44it/s]
297 up-deflection photodiode candidate events found
Checking best alignments

  0%|          | 0/299 [00:00&lt;?, ?it/s]
  1%|1         | 4/299 [00:00&lt;00:07, 39.55it/s]
  4%|4         | 12/299 [00:00&lt;00:06, 46.09it/s]
  7%|7         | 21/299 [00:00&lt;00:05, 53.55it/s]
  9%|9         | 28/299 [00:00&lt;00:04, 57.40it/s]
 11%|#1        | 34/299 [00:00&lt;00:05, 51.57it/s]
 13%|#3        | 40/299 [00:00&lt;00:05, 47.03it/s]
 16%|#6        | 49/299 [00:00&lt;00:04, 54.29it/s]
 19%|#8        | 56/299 [00:00&lt;00:04, 53.69it/s]
 21%|##1       | 63/299 [00:01&lt;00:04, 57.02it/s]
 24%|##3       | 71/299 [00:01&lt;00:04, 56.20it/s]
 26%|##5       | 77/299 [00:01&lt;00:04, 49.62it/s]
 28%|##8       | 84/299 [00:01&lt;00:04, 47.14it/s]
 30%|###       | 90/299 [00:01&lt;00:04, 46.09it/s]
 32%|###2      | 96/299 [00:01&lt;00:04, 45.97it/s]
 34%|###4      | 103/299 [00:01&lt;00:03, 50.48it/s]
 36%|###6      | 109/299 [00:02&lt;00:03, 51.33it/s]
 38%|###8      | 115/299 [00:02&lt;00:03, 46.85it/s]
 41%|####      | 122/299 [00:02&lt;00:03, 51.70it/s]
 43%|####3     | 129/299 [00:02&lt;00:03, 53.75it/s]
 46%|####5     | 137/299 [00:02&lt;00:02, 58.95it/s]
 48%|####8     | 145/299 [00:02&lt;00:02, 63.28it/s]
 52%|#####1    | 154/299 [00:02&lt;00:02, 66.86it/s]
 54%|#####3    | 161/299 [00:02&lt;00:02, 64.83it/s]
 56%|#####6    | 168/299 [00:03&lt;00:02, 54.15it/s]
 59%|#####8    | 176/299 [00:03&lt;00:02, 59.75it/s]
 61%|######1   | 183/299 [00:03&lt;00:02, 55.77it/s]
 63%|######3   | 189/299 [00:03&lt;00:02, 54.86it/s]
 65%|######5   | 195/299 [00:03&lt;00:01, 54.33it/s]
 68%|######7   | 203/299 [00:03&lt;00:01, 56.75it/s]
 72%|#######1  | 215/299 [00:03&lt;00:01, 65.78it/s]
 75%|#######4  | 223/299 [00:03&lt;00:01, 57.31it/s]
 77%|#######6  | 230/299 [00:04&lt;00:01, 54.46it/s]
 80%|#######9  | 238/299 [00:04&lt;00:01, 59.22it/s]
 84%|########3 | 251/299 [00:04&lt;00:00, 70.74it/s]
 88%|########8 | 264/299 [00:04&lt;00:00, 77.23it/s]
 91%|#########1| 273/299 [00:04&lt;00:00, 74.95it/s]
 94%|#########4| 282/299 [00:04&lt;00:00, 65.29it/s]
 97%|#########6| 290/299 [00:04&lt;00:00, 66.42it/s]
100%|#########9| 298/299 [00:04&lt;00:00, 69.04it/s]
100%|##########| 299/299 [00:04&lt;00:00, 60.74it/s]
Best alignment with the events shifted 12 ms relative to the first behavior event
errors: min -3, q1 -1, med 0, q3 1, max 75
Excluding events that have zero close events or more than one photodiode event within `max_len` time
Event 8 recovered (not excluded)
Event 144 recovered (not excluded)
Event 234 recovered (not excluded)
</pre></div>
</div>
<p>Find cessations of the photodiode deflections</p>
<p>Since we manually intervened for the onsets, on those same trials, we’ll
have to manually intervene for the offsets.</p>
<p>On the documentation webpage, this is example is not interactive,
but if you download it as a jupyter notebook and run it or copy the code
into a console running python (ipython recommended), you can see how to
interact with the photodiode data to pick reasonable parameters by
following the instructions.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pd_parser</span><span class="o">.</span><span class="n">add_pd_off_events</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">off_event_name</span><span class="o">=</span><span class="s1">&#39;Stim Off&#39;</span><span class="p">)</span>
</pre></div>
</div>
<ul class="sphx-glr-horizontal">
<li><img alt="Use the left/right keys to find the event offset +/- to scale the x axis press enter when finished or `e` to exclude the event" class="sphx-glr-multi-img" src="../_images/sphx_glr_plot_recover_events_007.png" />
</li>
<li><img alt="Use the left/right keys to find the event offset +/- to scale the x axis press enter when finished or `e` to exclude the event" class="sphx-glr-multi-img" src="../_images/sphx_glr_plot_recover_events_008.png" />
</li>
<li><img alt="Use the left/right keys to find the event offset +/- to scale the x axis press enter when finished or `e` to exclude the event" class="sphx-glr-multi-img" src="../_images/sphx_glr_plot_recover_events_009.png" />
</li>
</ul>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Reading in /var/folders/s4/y1vlkn8d70jfw7s8s03m9p540000gn/T/tmp_mne_tempdir_de9nwvs_/sub-1_task-mytask_raw.fif
Opening raw data file /var/folders/s4/y1vlkn8d70jfw7s8s03m9p540000gn/T/tmp_mne_tempdir_de9nwvs_/sub-1_task-mytask_raw.fif...
Isotrak not found
    Range : 0 ... 2035103 =      0.000 ...  2035.103 secs
Ready.
Reading 0 ... 2035103  =      0.000 ...  2035.103 secs...

  0%|          | 0/16269 [00:00&lt;?, ?it/s]
  2%|1         | 307/16269 [00:00&lt;00:05, 3062.11it/s]
  5%|4         | 756/16269 [00:00&lt;00:04, 3383.39it/s]
  6%|5         | 975/16269 [00:00&lt;00:05, 2900.93it/s]
  8%|8         | 1327/16269 [00:00&lt;00:04, 3054.18it/s]
 10%|#         | 1634/16269 [00:00&lt;00:04, 3057.32it/s]
 12%|#1        | 1900/16269 [00:00&lt;00:05, 2722.11it/s]
 14%|#4        | 2311/16269 [00:00&lt;00:04, 3027.41it/s]
 16%|#6        | 2673/16269 [00:00&lt;00:04, 3183.26it/s]
 19%|#8        | 3033/16269 [00:00&lt;00:04, 3296.18it/s]
 21%|##        | 3413/16269 [00:01&lt;00:03, 3432.29it/s]
 23%|##3       | 3758/16269 [00:01&lt;00:03, 3418.20it/s]
 26%|##5       | 4215/16269 [00:01&lt;00:03, 3697.33it/s]
 29%|##9       | 4740/16269 [00:01&lt;00:02, 4057.14it/s]
 32%|###1      | 5162/16269 [00:01&lt;00:02, 3912.52it/s]
 35%|###4      | 5661/16269 [00:01&lt;00:02, 4182.27it/s]
 38%|###7      | 6171/16269 [00:01&lt;00:02, 4420.30it/s]
 41%|####1     | 6680/16269 [00:01&lt;00:02, 4601.02it/s]
 44%|####4     | 7182/16269 [00:01&lt;00:01, 4718.29it/s]
 47%|####7     | 7715/16269 [00:01&lt;00:01, 4886.12it/s]
 50%|#####     | 8212/16269 [00:02&lt;00:01, 4834.88it/s]
 53%|#####3    | 8701/16269 [00:02&lt;00:01, 4488.88it/s]
 56%|#####6    | 9159/16269 [00:02&lt;00:01, 4051.54it/s]
 59%|#####8    | 9579/16269 [00:02&lt;00:01, 3634.93it/s]
 61%|######1   | 9961/16269 [00:02&lt;00:01, 3493.90it/s]
 63%|######3   | 10325/16269 [00:02&lt;00:01, 3354.56it/s]
 66%|######5   | 10672/16269 [00:02&lt;00:01, 3231.41it/s]
 68%|######8   | 11084/16269 [00:02&lt;00:01, 3453.96it/s]
 71%|#######   | 11499/16269 [00:03&lt;00:01, 3636.67it/s]
 74%|#######3  | 11973/16269 [00:03&lt;00:01, 3908.05it/s]
 77%|#######6  | 12447/16269 [00:03&lt;00:00, 4123.81it/s]
 79%|#######9  | 12924/16269 [00:03&lt;00:00, 4293.92it/s]
 82%|########2 | 13364/16269 [00:03&lt;00:00, 4077.49it/s]
 85%|########5 | 13833/16269 [00:03&lt;00:00, 4242.77it/s]
 88%|########7 | 14266/16269 [00:03&lt;00:00, 4261.11it/s]
 91%|######### | 14747/16269 [00:03&lt;00:00, 4410.52it/s]
 94%|#########3| 15227/16269 [00:03&lt;00:00, 4514.88it/s]
 96%|#########6| 15683/16269 [00:03&lt;00:00, 4404.48it/s]
100%|#########9| 16208/16269 [00:04&lt;00:00, 4627.82it/s]
100%|##########| 16269/16269 [00:04&lt;00:00, 4010.28it/s]
Overwriting existing file.

&lt;Annotations | 597 segments: Stim Off (297), Stim On (300)&gt;
</pre></div>
</div>
<p>Check the results:</p>
<p>Finally, we’ll check that the recovered events and the original events match.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">annot</span> <span class="o">=</span> <span class="n">_load_data</span><span class="p">(</span><span class="n">fname</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">raw</span><span class="o">.</span><span class="n">set_annotations</span><span class="p">(</span><span class="n">annot</span><span class="p">)</span>
<span class="n">events2</span><span class="p">,</span> <span class="n">event_id</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">events_from_annotations</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
<span class="n">on_events</span> <span class="o">=</span> <span class="n">events2</span><span class="p">[</span><span class="n">events2</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">event_id</span><span class="p">[</span><span class="s1">&#39;Stim On&#39;</span><span class="p">]]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Original: </span><span class="si">{</span><span class="n">events</span><span class="p">[</span><span class="n">corrupted_indices</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
      <span class="sa">f</span><span class="s1">&#39;Recovered: </span><span class="si">{</span><span class="n">on_events</span><span class="p">[</span><span class="n">corrupted_indices</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd"># uncomment when using interactively, this section doesn&#39;t work</span>
<span class="sd"># for the non-interactive documentation</span>
<span class="sd">off_events = events2[events2[:, 2] == event_id[&#39;Stim Off&#39;]]</span>
<span class="sd">original_off = events[corrupted_indices, 0] + \</span>
<span class="sd">  np.round(n_secs_on[corrupted_indices] * raw.info[&#39;sfreq&#39;]).astype(int)</span>
<span class="sd">print(f&#39;Original off: {original_off}\n&#39;</span>
<span class="sd">      f&#39;Recovered off: {on_events[corrupted_indices, 0]}&#39;)</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Reading in /var/folders/s4/y1vlkn8d70jfw7s8s03m9p540000gn/T/tmp_mne_tempdir_de9nwvs_/sub-1_task-mytask_raw.fif
Opening raw data file /var/folders/s4/y1vlkn8d70jfw7s8s03m9p540000gn/T/tmp_mne_tempdir_de9nwvs_/sub-1_task-mytask_raw.fif...
Isotrak not found
    Range : 0 ... 2035103 =      0.000 ...  2035.103 secs
Ready.
Used Annotations descriptions: [&#39;Stim Off&#39;, &#39;Stim On&#39;]
Original: [  65602  989660 1595483]
Recovered: [  65602  989660 1595483]

&quot;\n# uncomment when using interactively, this section doesn&#39;t work\n# for the non-interactive documentation\noff_events = events2[events2[:, 2] == event_id[&#39;Stim Off&#39;]]\noriginal_off = events[corrupted_indices, 0] +   np.round(n_secs_on[corrupted_indices] * raw.info[&#39;sfreq&#39;]).astype(int)\nprint(f&#39;Original off: {original_off}\n&#39;\n      f&#39;Recovered off: {on_events[corrupted_indices, 0]}&#39;)\n&quot;
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  30.425 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-plot-recover-events-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/3b9b6f3cd8645b6f7e8cdb8a4aee6517/plot_recover_events.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_recover_events.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/5258f1bb54b38679ec8488158187b98c/plot_recover_events.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_recover_events.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2020, Alex Rockhill.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.3.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>